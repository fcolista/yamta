{% extends 'base.html' %}
{% block header %}History{% endblock %}

{% block fab %}{% endblock %}

{% block content %}
<div class="px-4 py-6">
    <!-- Filter Section -->
    <form method="get" class="mb-6 bg-white dark:bg-[#1a3629] p-4 rounded-xl shadow-sm border border-slate-100 dark:border-white/5 flex flex-wrap gap-4 items-end">
        <div class="flex-1 min-w-[120px]">
            <label for="month" class="block text-xs font-semibold text-slate-500 dark:text-slate-400 mb-1">Month</label>
            <select name="month" id="month" class="form-select w-full rounded-lg border-slate-200 dark:border-white/10 bg-background-light dark:bg-background-dark text-slate-900 dark:text-white text-sm focus:border-primary focus:ring-primary py-2">
                <option value="all">All Months</option>
                <option value="1" {% if selected_month == 1 %}selected{% endif %}>January</option>
                <option value="2" {% if selected_month == 2 %}selected{% endif %}>February</option>
                <option value="3" {% if selected_month == 3 %}selected{% endif %}>March</option>
                <option value="4" {% if selected_month == 4 %}selected{% endif %}>April</option>
                <option value="5" {% if selected_month == 5 %}selected{% endif %}>May</option>
                <option value="6" {% if selected_month == 6 %}selected{% endif %}>June</option>
                <option value="7" {% if selected_month == 7 %}selected{% endif %}>July</option>
                <option value="8" {% if selected_month == 8 %}selected{% endif %}>August</option>
                <option value="9" {% if selected_month == 9 %}selected{% endif %}>September</option>
                <option value="10" {% if selected_month == 10 %}selected{% endif %}>October</option>
                <option value="11" {% if selected_month == 11 %}selected{% endif %}>November</option>
                <option value="12" {% if selected_month == 12 %}selected{% endif %}>December</option>
            </select>
        </div>
        
        {% if dates %}
        <div class="flex-1 min-w-[120px]">
            <label for="year" class="block text-xs font-semibold text-slate-500 dark:text-slate-400 mb-1">Year</label>
            <select name="year" id="year" class="form-select w-full rounded-lg border-slate-200 dark:border-white/10 bg-background-light dark:bg-background-dark text-slate-900 dark:text-white text-sm focus:border-primary focus:ring-primary py-2">
                <option value="all">All Years</option>
                {% regroup dates by year as year_list %}
                {% for year in year_list %}
                    <option value="{{ year.grouper }}" {% if selected_year == year.grouper %}selected{% endif %}>{{ year.grouper }}</option>
                {% endfor %}
            </select>
        </div>
        {% endif %}
        
        <div class="">
            <button type="submit" class="bg-primary text-white font-medium py-2 px-4 rounded-lg shadow-sm hover:bg-primary/90 transition-colors">
                Filter
            </button>
        </div>
    </form>

    <div class="flex flex-col gap-3">
        {% for journey in journeys %}
        <a href="{% url 'edit_journey' journey.id %}" class="block">
            <div class="flex items-center gap-4 bg-white dark:bg-[#1a3629] px-4 min-h-[80px] py-3 justify-between rounded-xl shadow-sm border border-slate-100 dark:border-white/5 relative group">
                <div class="flex items-center gap-4">
                    <div class="text-primary flex items-center justify-center rounded-lg bg-primary/10 shrink-0 size-12">
                        <span class="material-symbols-outlined">directions_car</span>
                    </div>
                    <div class="flex flex-col justify-center">
                        <p class="text-slate-900 dark:text-white text-base font-bold leading-normal">{{ journey.distance }} km</p>
                        <p class="text-slate-500 dark:text-[#92c9ad] text-xs font-medium leading-normal">{{ journey.date|date:"M d, Y" }} â€¢ {{ journey.reason }}</p>
                    </div>
                </div>
                <div class="shrink-0 flex flex-col items-end">
                    <p class="text-slate-900 dark:text-white text-base font-bold leading-normal">{{ currency }}{{ journey.total_cost }}</p>
                    <span class="text-[10px] uppercase tracking-wider text-slate-400 font-bold">{{ journey.fuel_type }}</span>
                </div>
            </div>
        </a>
        {% empty %}
        <div class="flex flex-col items-center justify-center py-20 px-4 text-center text-slate-500">
            <span class="material-symbols-outlined text-4xl mb-2 text-slate-300">history</span>
            <p>No journey history found.</p>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}
